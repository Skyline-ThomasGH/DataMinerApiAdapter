# DataMiner API Adapter

This example project demonstrates how to connect to **DataMiner** and expose a simple HTTP GET endpoint to retrieve `Job` DOM instances. It also includes a minimal example of how to set up a subscription to receive DOM updates and push them to clients via **SignalR**.

> Note: This project is intended as a demonstration. Many production best practices are not implemented (dependency injection, error handling, reconnect logic, etc.).

---

## DOM Model

The file `Basic Jobs DOM Model Creator.xml` is an importable **DataMiner Automation script**. It creates a basic DOM module with a `Job` DOM definition, which can be used for testing this adapter.

---

## SignalR Integration

The project includes a **SignalR hub** and a demo web page to show how updates from DataMiner can be pushed to a client in real-time.

- The SignalR hub is minimal and server-driven.
- You can integrate the SignalR connection into your own **React, Angular, Vue, or other front-end** applications.

---

## Project Structure

- **App_Start**
  - `WebApiConfig.cs` — Configures Web API routes and controllers.

- **Controllers**
  - `JobsController.cs` — Defines the HTTP GET endpoint to retrieve all jobs.

- **Hubs**
  - `JobsHub.cs` — Empty SignalR hub used to broadcast job update events.

- **Models**
  - `Job.cs` — C# model representing a Job. Returned by the GET API.
  - `JobsUpdatedEvent.cs` — Model representing a job update event, pushed to clients via SignalR when a DOM instance is updated in DataMiner.

- **Scripts**
  - Generated by the SignalR NuGet package. Required for the `index.html` demo page. Not necessary if you integrate SignalR into a separate front-end application.

- **Services**
  - `DataMinerAdapterService.cs` — Sets up the connection to DataMiner, subscribes to events, and pushes updates via SignalR.
  - `JobsService.cs` — Retrieves `Job` DOM instances from DataMiner and maps them to the `Job` model.

- **index.html** — Minimal demo web page that displays job updates received from SignalR in a table.

- **Startup.cs** — Configures SignalR and ensures the `DataMinerAdapterService` subscribes to DataMiner events at application startup.

---

## Getting Started

### Prerequisites

- Windows with **Visual Studio** (2019 or later)
- **.NET Framework 4.7.2+** (or compatible version)
- Access to a **DataMiner agent** for testing
- Browser for viewing the `index.html` demo page

---

### Running the Project

1. **Clone the repository**
   ```bash
   git clone https://github.com/Skyline-ThomasGH/DataMinerApiAdapter.git
   cd DataMinerApiAdapter
   ```

1. **Open the solution** in Visual Studio.

1. **Restore NuGet packages** (should happen automatically).

1. **Add a user to the test DataMiner agent**

1. **Update `DataMinerAdapterService.cs`** to authenticate using that user.

1. **Run the project** (F5 or Ctrl+F5).
   - By default, IIS Express will start and the API will be hosted on `localhost:<port>`.

1. **Open the demo page**
   - Navigate to `http://localhost:<port>/index.html` in your browser.
   - You should see job updates pushed in real-time via SignalR when creating, updating or deleting a DOM instance in the 'my_dom_module' DOM module.

---

### Notes

- For production usage, implement proper **error handling, logging, and reconnect logic**.
- Front-end integration: You can use the SignalR hub in any web framework (React, Angular, Vue, etc.) by referencing the SignalR client library.
- CORS: If your front-end is hosted on a different domain, enable CORS in `WebApiConfig.cs` and in the SignalR configuration.
